package im.hyphen.util;

import java.io.File;
import java.io.FileOutputStream;
import java.io.PrintStream;
import java.util.Calendar;

public class LUtil
{
	static String LOG_DIR = null;
	private static synchronized boolean init()
	{
		if (null == LOG_FILE || CUtil.isNew())
		{
			LOG_DIR = CUtil.get("LOG_PATH");
			if (null == LOG_DIR) return false;

			File log_dir = new File(LOG_DIR);
			if (!log_dir.exists()) log_dir.mkdirs();
		}
		return true;
	}

	static Calendar LOG_CAL     = Calendar.getInstance();
	static String LOG_DT        = null;
	static String LOG_FILE      = null;
	static String  LOG_PREFIX   = null;
	
	private static synchronized void day_check(String curr_dt8)
	{
		if (LOG_DT == null || !LOG_DT.equals(curr_dt8))
		{

			StringBuffer sb = new StringBuffer();

			sb.append(LOG_DIR);
			if (!LOG_DIR.endsWith("/") && !LOG_DIR.endsWith("\\")) sb.append('/');

			sb.append(curr_dt8);
			sb.append(".log");

			LOG_FILE = sb.toString();

			LOG_DT = curr_dt8;
		}
	}
	
	public static void println(Object pstr)
	{
		if (!init())
		{
			System.out.println("ERROR LOG_PATH !!");
			return;
		}

		String curr_date = SUtil.getCurrDate();

		day_check(curr_date.substring(0,8));

		File openFile = new File(LOG_FILE);
		PrintStream out = null;

		try{
			if(openFile.exists()){
				out = new PrintStream(new FileOutputStream(LOG_FILE, true), true);
			}else{
				out = new PrintStream(new FileOutputStream(LOG_FILE), true);
			}
		}catch(Exception e){
			e.printStackTrace();
		}

		if (pstr instanceof Throwable)
		{
			Throwable tw = (Throwable)pstr;
			tw.printStackTrace(out);
			out.println();
		}else
		{
			StringBuffer sb = new StringBuffer();

			sb.append("[");
			sb.append(curr_date.substring(8,10)).append(":").append(curr_date.substring(10,12)).append(":").append(curr_date.substring(12,14));
			sb.append("]" );
			sb.append(pstr);

			out.println(sb.toString());
		}
		out.close();
	}
	
	
	
}
